<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scenario 1 — General transactions</title>
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>
  <a class="skip-link" href="#calc">Skip to calculator</a>

  <header class="site-header container">
    <h1>Scenario 1 — General transactions</h1>
    <p class="muted">General transactions having VAT and PPDA.</p>
  </header>

  <main id="calc" class="container" role="main">
    <form id="wht-form" aria-label="Withholding tax calculator" novalidate>
      <div>
        <label for="invoice-amount"><strong>Invoice amount (total included)</strong></label>
        <input id="invoice-amount" name="invoiceAmount" type="number" inputmode="decimal" step="0.01" required aria-required="true" />
      </div>

      <div>
        <label for="vat-rate">VAT rate (%)</label>
        <input id="vat-rate" name="vatRate" type="number" step="0.01" value="17.5" required />
      </div>

      <div>
        <label for="ppda">PPDA rate (%)</label>
        <input id="ppda" name="ppda" type="number" step="0.01" value="1.0" required />
      </div>

      <div>
        <label for="wht-rate">WHT rate (%)</label>
        <input id="wht-rate" name="whtRate" type="number" step="0.01" value="3.0" required />
      </div>

      <div style="margin-top:.75rem">
        <button id="calc-btn" type="submit">Calculate</button>
        <button id="reset-btn" type="button">Reset</button>
      </div>
    </form>

    <section id="results" aria-live="polite" style="margin-top:1rem"></section>

    <p style="margin-top:1rem"><a href="../index.html">Back to selection</a></p>
  </main>

  <script type="module">
  try {
    import('./scenario1.js').then(({ computeBaseAmount }) => {
      const form = document.getElementById('wht-form');
      const results = document.getElementById('results');
      const resetBtn = document.getElementById('reset-btn');

      function formatCurrency(n) {
        return new Intl.NumberFormat(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        results.innerHTML = '';
        try {
          const invoice = document.getElementById('invoice-amount').value;
          const vatRate = document.getElementById('vat-rate').value;
          const ppdaRate = document.getElementById('ppda').value;
          const whtRate = document.getElementById('wht-rate').value;

          console.log('Inputs:', { invoice, vatRate, ppdaRate, whtRate });

          const out = computeBaseAmount({
            invoice,
            vatRate,
            ppdaRate,
            whtRate,
            rounding: 2
          });

          console.log('Output:', out);

          results.innerHTML = `
            <div class="result-card">
              <div class="result-row"><div class="result-label">Taxable amount</div><div class="result-value">MK ${formatCurrency(out.taxableAmount)}</div></div>
              <div class="result-row"><div class="result-label">VAT (MK)</div><div class="result-value">MK ${formatCurrency(out.vatAmount)}</div></div>
              <div class="result-row"><div class="result-label">PPDA (MK)</div><div class="result-value">MK ${formatCurrency(out.ppdaAmount)}</div></div>
              <div class="result-row"><div class="result-label">WHT (MK)</div><div class="result-value">MK ${formatCurrency(out.whtAmount)}</div></div>
              <div class="result-row"><div class="result-label">Pay supplier</div><div class="result-value">MK ${formatCurrency(out.paySupplier)}</div></div>
            </div>
          `;
        } catch (err) {
          console.error('Calculation error:', err);
          results.innerHTML = `<div role="alert">Error: ${err.message}</div>`;
        }
      });

      resetBtn.addEventListener('click', () => {
        form.reset();
        results.innerHTML = '';
        document.getElementById('vat-rate').value = '17.5';
        document.getElementById('ppda').value = '1.0';
        document.getElementById('wht-rate').value = '3.0';
      });

    }).catch(err => {
      console.error('Failed to import module:', err);
      const results = document.getElementById('results');
      if (results) results.innerHTML = `<div role="alert">Module load error: ${err.message}</div>`;
    });
  } catch (err) {
    console.error('Unexpected error setting up module import:', err);
    const results = document.getElementById('results');
    if (results) results.innerHTML = `<div role="alert">Setup error: ${err.message}</div>`;
  }
  </script>
</body>
</html>